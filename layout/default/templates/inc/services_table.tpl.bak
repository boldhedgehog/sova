{*assign var=services value=$host.services*}
{assign var=nagiosServices value=$host.nagios.services}
<table class="grid services" id="services{$host.nagios.md5}">
    {if !$isAjax}
    <thead>
	<tr>
	    <th class="nofilter">З/К</th>
        <th>Найменування</th>
	    <th class="state">Стан</th>
	    <th>Повідомлення</th>
	    <th class="time nofilter">Останнє оновлення</th>
	    <th class="time nofilter">Остання зміна статусу</th>
        <th class="time nofilter">Тривалість</th>
	</tr>
    </thead>
    {/if}
    <tbody>
        {foreach name=services from=$nagiosServices|@sortby:"db_data.zone.plas_zone_id,db_data.alias" item=service}
        {assign var=dbService value=$service.db_data}
        {if $dbService}
            {assign var=serviceName value=$dbService.alias}
        {else}
            {if $service.notes_expanded}
                {assign var=serviceName value=$service.notes_expanded}
            {else}
                {assign var=serviceName value=$service.display_name}
            {/if}
        {/if}

        {if $dbService.zone and $dbService.zone_id != $_old_zone_id}
            {assign var=zone_row_type value="new"}
        {elseif $dbService.zone.name}
            {assign var=zone_row_type value="continue"}
        {else}
            {assign var=zone_row_type value="empty"}
        {/if}
            
        <tr
	    id="service{$service.md5}" title="{$dbService.zone.name}" class="state{$service.state}{if $smarty.foreach.services.first} first{elseif $smarty.foreach.services.first} first{/if} zone-row-id-{$dbService.zone.zone_id}{if $zone_row_type == "new"} zone-row-start{elseif $zone_row_type == "continue"} zone-row-continue{/if}">
            {if $zone_row_type == "new"}
                <td class="zone-header first"><h4><span class="zone-id">{$dbService.zone.plas_zone_id}</span></h4></td>
            {elseif $zone_row_type == "continue"}
                <td class="zone-continue first">&sdot;//&sdot;</td>
            {else}
                <td class="zone-header-empty first">&mdash;</td>
            {/if}
            <td>
                {if $dbService && !$nolinks}<a href="{$smarty.const.SOVA_BASE_URL}service/index/id/{$host.host_id}:{$service.description|escape:"url"}" title="{$serviceName}" class="serviceLink{if $dbService.type eq 'service'} service{/if}">{/if}<span id="service[{$host.host_id}:{$service.description|escape:"javascript"}]">{$serviceName}</span>{if $dbService && !$nolinks}</a>{/if}
                {*if $service.state_duration}<span class="duration">({$service.state_duration|human_interval})</span>{/if*}
                <div class="serviceImages">
                    <img class="imgAcknowleged{if $service.acknowledged != 1} hidden{/if}" src="{$smarty.const.SOVA_BASE_URL}skin/{$smarty.const.LAYOUT_NAME}/images/ack.gif" alt="ОБР" title="Сервіс в обробці"/>
                    <img class="imgComments{if not $service.comments} hidden{/if}" src="{$smarty.const.SOVA_BASE_URL}skin/{$smarty.const.LAYOUT_NAME}/images/comment.gif" alt="КОМ" title="Коментарі: {$service.comments|@count}"/>
                    <img class="imgFlapping{if not $service.is_flapping} hidden{/if}" src="{$smarty.const.SOVA_BASE_URL}skin/{$smarty.const.LAYOUT_NAME}/images/flapping.gif" alt="МЕР" title="Мерехтіння"/>
                </div>
            </td>
            <td class="state bgServiceState{$service.state}">{$service.state_text}</td>
            <td>{$service.plugin_output}</td>
            <td class="time">{$service.last_check|date_format:'%Y-%m-%d %H:%M:%S'}</td>
            <td class="time">{$service.last_state_change|date_format:'%Y-%m-%d %H:%M:%S'}</td>
            <td class="last">{if $service.state_duration}{$service.state_duration|human_interval}{else}&nbsp;{/if}</td>
        </tr>
        {assign var=_old_zone_id value=$dbService.zone_id}
        {foreachelse}

        {/foreach}
    </tbody>
</table>